---
name: ðŸ·ï¸ Tag

on:
  push:
    branches:
      - main
    paths:
      - ".changes/*.md"

permissions:
  contents: read

jobs:
  release-tag:
    name: ðŸ·ï¸ Set Release Tag
    runs-on: ubuntu-24.04
    permissions:
      contents: write
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      - name: ðŸ·ï¸ Check for Tag
        uses: dorny/paths-filter@de90cc6fb38fc0963ad72b210f1f284cd68cea36 # v3.0.2
        id: release_tag
        with:
          list-files: shell
          filters: |
            changelog:
              - added: '.changes/*.md'

      - name: ðŸ·ï¸ Get Release Tag
        if: ${{ steps.release_tag.outputs.changelog == 'true' }}
        run: |
          echo "RELEASE_TAG=$(basename "${{ steps.release_tag.outputs.changelog_files }}" .md)" >> $GITHUB_ENV

      - name: ðŸ¤– Get bot details
        if: ${{ steps.release_tag.outputs.changelog == 'true' }}
        id: bot-details
        uses: raven-actions/bot-details@b2d5fd6eb98adc0cb67df864daa834849f3a8bc0 # v1.1.0
        with:
          set-env: false

      - name: ðŸ”– Push Release Tag
        if: ${{ steps.release_tag.outputs.changelog == 'true' }}
        run: |
          git config --global user.name "${{ steps.bot-details.outputs.name }}"
          git config --global user.email "${{ steps.bot-details.outputs.email }}"
          git tag -a "${{ env.RELEASE_TAG }}" -m "${{ env.RELEASE_TAG }}"
          git push origin --follow-tags

      - name: ðŸš€ Release
        if: ${{ steps.release_tag.outputs.changelog == 'true' }}
        uses: peter-evans/repository-dispatch@28959ce8df70de7be546dd1250a005dd32156697 # v4.0.1
        with:
          event-type: release
          client-payload: '{"tag": "${{ env.RELEASE_TAG }}"}'
